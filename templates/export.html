{% extends "base.html" %}

{% block title %}Manage Export Templates - Video Automation{% endblock %}

{% block extra_css %}
<style>
    .template-container {
        background-color: #fff;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }

    h1 {
        margin-bottom: 20px;
    }

    .btn-green {
        background-color: #2ecc71;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1em;
    }
    .btn-green:hover {
        background-color: #27ae60;
    }

    .btn-blue {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1em;
    }
    .btn-blue:hover {
        background-color: #2980b9;
    }

    .btn-red {
        background-color: #e74c3c;
        color: white;
        border: none;
        padding: 7px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9em;
    }
    .btn-red:hover {
        background-color: #c0392b;
    }

    .template-list {
        margin-top: 10px;
        border-collapse: collapse;
        width: 100%;
    }
    .template-list th, .template-list td {
        border: 1px solid #ddd;
        padding: 8px 12px;
    }
    .template-list th {
        background-color: #f2f2f2;
    }
</style>
{% endblock %}

{% block content %}
<h1>Export Templates</h1>
<div class="template-container">
    <div style="margin-bottom:10px;">
        <a href="{{ url_for('main.create_export_template') }}" class="btn-green">Create New Template</a>
    </div>

    {% if templates %}
        <table class="template-list">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Columns</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for t in templates %}
                <tr>
                    <td>{{ t.name }}</td>
                    <td>{{ t.get_columns()|join(', ') }}</td>
                    <td>
                        <a class="btn-blue" href="{{ url_for('main.edit_export_template', template_id=t.id) }}">Edit</a>
                        <a class="btn-red" href="#" onclick="deleteTemplate('{{ t.id }}')">Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No templates found. Create one above.</p>
    {% endif %}
</div>

<script>
    function deleteTemplate(templateId) {
        if (confirm("Are you sure you want to delete this template?")) {
            fetch(`/export/templates/${templateId}`, {
                method: 'DELETE',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to delete template');
                }
                // Reload page if successful
                window.location.reload();
            })
            .catch(err => {
                alert(err.message);
            });
        }
    }
</script>
{% endblock %}
